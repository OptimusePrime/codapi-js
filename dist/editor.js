var n={off:"off",basic:"basic",external:"external"},i=class extends EventTarget{constructor(e,t,s){super(),this.el=e,this.mode=t,this.executeFunc=s,this.fixFormatting(),this.listen()}listen(){if(this.mode!=n.off){if(this.mode==n.external){this.el.addEventListener("keydown",this.handleExecute.bind(this));return}this.el.contentEditable="true",this.el.addEventListener("keydown",this.handleIndent.bind(this)),this.el.addEventListener("keydown",this.handleHide.bind(this)),this.el.addEventListener("keydown",this.handleExecute.bind(this)),this.el.addEventListener("paste",this.onPaste.bind(this)),this.onFocus=this.initEditor.bind(this),this.el.addEventListener("focus",this.onFocus)}}initEditor(e){let t=e.target;t.innerHTML.includes("</span>")&&(t.textContent=t.textContent),t.removeEventListener("focus",this.onFocus),delete this.onFocus}handleIndent(e){e.key=="Tab"&&(e.preventDefault(),document.execCommand("insertHTML",!1," ".repeat(4)))}handleHide(e){e.key=="Escape"&&(e.preventDefault(),this.dispatchEvent(new Event("hide")))}handleExecute(e){!e.ctrlKey&&!e.metaKey||e.key!=="Enter"&&e.key!=="NumpadEnter"||(e.preventDefault(),this.executeFunc())}onPaste(e){e.preventDefault();let t=(e.originalEvent||e).clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}fixFormatting(){setTimeout(()=>{this.el.innerHTML=this.el.innerHTML.replaceAll("<br>",`
`).replace(/[\u00A0]/g," ")},0)}focusEnd(){this.el.focus();let e=window.getSelection();e.selectAllChildren(this.el),e.collapseToEnd()}get isEmpty(){return this.el.textContent.trim()==""}get value(){return this.el.textContent.trim()}set value(e){this.el.textContent=e}};export{i as CodeElement,n as EditorMode};
