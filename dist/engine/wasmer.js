var o=window.codapi??{};o.version=typeof VERSION<"u"?VERSION:"main";o.engines=o.engines??{};o.settings=o.settings??{};window.codapi=o;var p=class extends HTMLElement{connectedCallback(){this.ready||(o.settings.url=this.getAttribute("url"),this.ready=!0)}attributeChangedCallback(n,s,a){o.settings[n]=a}};window.customElements.get("codapi-settings")||customElements.define("codapi-settings",p);var e={lua:{program:"lua",repo:"https://github.com/nalgeon/lua-wasi",path:"https://unpkg.com/@antonz/lua-wasi@5.4.6/dist",file:"lua.wasm"},php:{program:"php",repo:"https://github.com/nalgeon/php-wasi",path:"https://unpkg.com/@antonz/php-wasi@8.2.6/dist",file:"php-cgi.wasm"},python:{program:"python",repo:"https://github.com/nalgeon/python-wasi",path:"https://unpkg.com/@antonz/python-wasi@3.12.0/dist",file:"python.wasm"},ruby:{program:"ruby",repo:"https://github.com/nalgeon/ruby-wasi",path:"https://unpkg.com/@antonz/ruby-wasi@3.2.2/dist",file:"ruby.wasm"},sqlite:{program:"sqlite3",repo:"https://github.com/nalgeon/sqlite-wasi",path:"https://unpkg.com/@antonz/sqlite-wasi@3.44.2/dist",file:"sqlite.wasm"}};var i={lua:{run:{steps:[{box:"lua",stdin:!0,entry:"main.lua",args:["-e","main.lua"]}]}},php:{run:{steps:[{box:"php",entry:"main.php",args:["--no-header","--no-php-ini","/src/main.php"]}]}},python:{run:{steps:[{box:"python",entry:"main.py",args:["/src/main.py"]}]}},ruby:{run:{steps:[{box:"ruby",entry:"main.rb",args:["/src/main.rb"]}]}},sqlite:{run:{steps:[{box:"sqlite",stdin:!0,entry:"main.sql",args:["-box",":memory:","main.sql"]}]}}};var{runWasix:h,Directory:l,Wasmer:f}=WasmerSDK,b=WasmerSDK.init,u={};async function c(t){if(!(t in e))throw Error(`unknown box: ${t}`);if(u[t])return u[t];let n=e[t],s=await $(n.url);return u[t]=n.type=="webc"?await f.fromFile(s):await WebAssembly.compile(s),u[t]}async function d(t){try{let n,s,a=y(t);for(let r of a.steps)if(x(r,t),[n,s]=await k(r,t),!n.ok)break;return{ok:n.ok,duration:s,stdout:n.stdout,stderr:n.stderr}}catch(n){return{ok:!1,duration:0,stdout:"",stderr:n.toString()}}}function y(t){if(!(t.sandbox in i))throw Error(`unknown sandbox: ${t.sandbox}`);if(!(t.command in i[t.sandbox]))throw Error(`unknown command: ${t.sandbox}.${t.command}`);return i[t.sandbox][t.command]}function x(t,n){return""in n.files&&(n.files[t.entry]=n.files[""],delete n.files[""]),n}async function k(t,n){let s=e[t.box],a=new Date,r=await c(t.box),m=E(t,n),w=await W(s,r,m,n),g=new Date-a;return[w,g]}function E(t,n){return t.stdin?t.args.map(s=>s==t.entry?n.files[t.entry]:s):t.args}async function W(t,n,s,a){return await(t.type=="webc"?await n.commands[t.program].run({args:s,mount:{"/out":new l,"/src":a.files}}):await h(n,{program:t.program,args:s,mount:{"/out":new l,"/src":a.files}})).wait()}async function $(t){let n=await fetch(t);if(!n.ok)throw new Error(`${t}: http status ${n.status}`);let s=await n.arrayBuffer();return new Uint8Array(s)}o.engines={...o.engines,wasi:{init:c,exec:d}};await b();var V={init:c,exec:d};export{V as default};
